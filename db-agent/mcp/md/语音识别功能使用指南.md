# 语音识别功能使用指南

## 快速开始

### 1. 启动服务

**启动主服务（端口8000）:**
```bash
python main.py
```

**启动语音识别服务（端口8001）:**
```bash
python speech_service.py
```

### 2. 使用语音输入

1. 打开浏览器访问: http://localhost:8000
2. 点击输入框右侧的麦克风按钮 🎤
3. 开始说话（按钮会变红）
4. 再次点击停止录音 ⏹️
5. 识别结果会自动填入输入框

## 系统要求

- Python 3.8+
- ffmpeg
- FireRedASR模型文件
- 现代浏览器（支持Web Audio API）

## 首次安装

1. **安装ffmpeg**
   ```bash
   # Windows (使用chocolatey)
   choco install ffmpeg
   
   # Linux
   sudo apt install ffmpeg
   
   # macOS
   brew install ffmpeg
   ```

2. **安装Python依赖**
   ```bash
   pip install fastapi uvicorn python-multipart
   cd FireRedASR
   pip install -r requirements.txt
   ```

3. **下载模型文件**
   
   确保以下文件存在:
   ```
   FireRedASR/pretrained_models/FireRedASR-AED-L/
     ├── model.pth.tar
     ├── config.yaml
     ├── dict.txt
     ├── cmvn.ark
     └── train_bpe1000.model
   ```

## 常见问题

### 服务无法启动

检查端口是否被占用：
```bash
# Windows
netstat -ano | findstr :8001

# Linux/Mac
lsof -i :8001
```

### 语音识别失败

1. 查看语音识别服务的日志输出
2. 确认ffmpeg已正确安装: `ffmpeg -version`
3. 确认模型文件存在

### 浏览器无麦克风权限

在浏览器设置中允许麦克风访问

## 详细文档

完整文档请参考: [docs/speech_recognition_setup.md](docs/speech_recognition_setup.md)

## 服务架构

```
前端 (端口8000) ←→ 主服务 (端口8000)
                          ↓
                  语音识别服务 (端口8001)
                          ↓
                     FireRedASR模型
```

## 更新说明

- 支持本地化部署，无需联网
- 实时录音和识别
- 自动音频格式转换
- 完善的错误处理和日志
